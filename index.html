<!DOCTYPE html>
<html>
  <head>
    <title>Arbol proyect</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1.0" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.css"
    />
    <style>
      #mapid {
        height: 400px;
      }
    </style>
  </head>
  <body>
    <h1>Ultima ubicación</h1>
    <p id="demo"></p>
    <div id="mapid"></div>
    <button onclick="speak()">Hablar</button>
    <script>
      function getLocation() {
        if (navigator.geolocation) {
          navigator.geolocation.watchPosition(showPosition, showError, {
            enableHighAccuracy: true,
          });
        } else {
          document.getElementById("demo").innerHTML =
            "La geolocalización no es compatible con este navegador.";
        }
      }
      function showError(e) {}
      function showPosition(position) {
        document.getElementById("demo").innerHTML =
          "Latitud: " +
          position.coords.latitude +
          "<br>Longitud: " +
          position.coords.longitude +
          "<br>Exactitud: " +
          parseInt(position.coords.accuracy) +
          " metros." +
          "<br>Altitud: " +
          (position.coords.altitude ? parseInt(position.coords.altitude) : 0) +
          " metros." +
          "<br>Velocidad: " +
          (position.coords.speed
            ? parseInt(convertirVelocidad(position.coords.speed))
            : 0) +
          "<br>Rumbo: " +
          position.coords.heading
            ? parseInt(position.coords.heading)
            : 0 +
              " grados." +
              "<br>Fecha y hora: " +
              new Date(position.timestamp).toLocaleString();
        try {
          map.setView(
            [position.coords.latitude, position.coords.longitude],
            22
          );
          marker.setLatLng([
            position.coords.latitude,
            position.coords.longitude,
          ]);
          marker
            .bindPopup(
              "<b>Ubicación específica</b><br>" +
                position.coords.latitude +
                ", " +
                position.coords.longitude +
                ""
            )
            .openPopup();
        } catch (e) {
          console.log(e);
        }
      }
      getLocation();
    </script>
    <script>
      var map = L.map("mapid").setView([40.7128, -74.006], 13);

      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution:
          'Map data © <a href="https://openstreetmap.org">OpenStreetMap</a> contributors',
        maxZoom: 18,
        id: "mapbox.streets",
      }).addTo(map);

      var marker = L.marker([40.7128, -74.006]).addTo(map);

      marker
        .bindPopup("<b>Ubicación específica</b><br>40.7128, -74.0060")
        .openPopup();
    </script>
    <script>
      var synthesis = window.speechSynthesis;
      var utterance = new SpeechSynthesisUtterance();
      utterance.lang = "es-ES";
      utterance.text = "Primera vuelta completada.";
      function speak() {
        synthesis.speak(utterance);
      }
    </script>
    <script>
      function convertirVelocidad(metrosPorSegundo) {
        const kilometrosPorHora = metrosPorSegundo * 3.6;
        const minutosPorKilometro = Math.floor(60 / kilometrosPorHora);
        const segundosPorKilometro = Math.round(
          (60 / kilometrosPorHora - minutosPorKilometro) * 60
        );
        return `${minutosPorKilometro} minutos y ${segundosPorKilometro} segundos por kilómetro`;
      }
    </script>
  </body>
</html>
